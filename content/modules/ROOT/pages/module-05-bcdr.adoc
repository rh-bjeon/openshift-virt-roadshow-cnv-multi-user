= 가상 머신 백업 및 복구

== 소개

데이터 보호는 모든 엔터프라이즈 워크로드에서 중요한 화두이며, OpenShift 가상화 환경에서는 가상 머신 백업 및 복구를 위한 다양한 옵션이 현재 제공되고 있습니다. 이러한 솔루션들은 대부분 OpenShift Pod를 보호하는 방식과 유사하게 작동합니다. 

가상 머신 또는 여러 가상 머신이 포함된 네임스페이스를 백업하여 원격에 위치한 오브젝트 스토리지에 저장하는 방식입니다. 이러한 백업에는 일반적으로 영구 스토리지 볼륨, 가상 머신을 정의하는 메타데이터 및 사용자 정의 리소스도 포함됩니다.

Red Hat 솔루션:

* https://docs.redhat.com/en/documentation/openshift_container_platform/4.18/html/backup_and_restore/oadp-application-backup-and-restore[*OpenShift APIs for Data Protection (OADP)*^]: Red Hat 오퍼레이터로, 스토리지에 구애받지 않고 가상 머신을 포함한 OpenShift 객체를 백업하고 복원할 수 있는 방법을 제공합니다.
* https://docs.redhat.com/en/documentation/red_hat_openshift_data_foundation/4.18/html/configuring_openshift_data_foundation_disaster_recovery_for_openshift_workloads/metro-dr-solution[*OpenShift Data Foundation Metro-DR*^] 과 https://docs.redhat.com/en/documentation/red_hat_openshift_data_foundation/4.18/html/configuring_openshift_data_foundation_disaster_recovery_for_openshift_workloads/rdr-solution[*OpenShift Data Foundation Regional-DR*^]

에코시스템 파트너 솔루션:

* https://www.cohesity.com/press/cohesity-enhances-data-protection-and-cyber-resilience-for-red-hat-openshift-virtualization-workloads/[*Cohesity DataProtect*^]
* https://docs.netapp.com/us-en/trident/index.html[*NetApp Trident Protect*^]
* https://portworx.com/blog/disaster-recovery-for-red-hat-openshift-virtualization/[*Portworx Disaster Recovery for OpenShift Virtualization*^]
* https://www.rubrik.com/solutions/openshift[*Rubrik for OpenShift*^]
* https://storware.eu/solutions/virtual-machine-backup-and-recovery/openshift-virtualization-and-kubevirt/[*Storware Backup and Recovery*^]
* https://docs.trilio.io/kubernetes/appendix/backup-and-restore-virtual-machine-running-on-openshift-virtualization[*Trilio for Kubernetes*^]
* https://docs.kasten.io/latest/usage/openshift_virtualization.html[*VEEAM Kasten*^]

NOTE: 이 목록은 지원되는 백업 및 복구 솔루션을 제공하는 모든 파트너를 망라하는 것이 아닙니다. 스토리지 또는 데이터 보호 솔루션 공급업체에 문의하여 해당 제품이 OpenShift 가상화와 호환되는지 확인하거나, https://catalog.redhat.com/platform/red-hat-openshift/virtualization#virtualization-infrastructure[Red Hat EcoSystem Catalog^] 에서 추가 정보를 확인하십시오.

이번 실습에서는 OADP를 사용하여 가상 머신 백업 및 복원 작업을 수행합니다.

[[review_operator]]
== OADP Operator 검토

. 다시 관리자 화면으로 이동한 다음 왼쪽 메뉴에서 `에코시스템` 을 클릭하고 `설치된 Operator` 를 클릭합니다. 프로젝트 *oadp-{user}* 가 선택되어 있는지 확인하십시오.
+
image::2025_summer/module-05-bcdr/00_Left_Menu.png[link=self, window=blank, width=100%]

. 해당 Operator를 클릭하면 상세 정보를 볼 수 있습니다.

. *제공되는 API* 를 검토하세요. 이 모듈에서는 `백업` 및 `복원` 기능을 사용합니다.
+
image::2025_summer/module-05-bcdr/01_Overview.png[link=self, window=blank, width=100%]

. 상단의 가로 스크롤 막대를 사용하여 `DataProtectionApplication` 탭으로 이동하십시오. 이 객체는 배포된 OADP 인스턴스의 구성을 나타냅니다.
+
image::2025_summer/module-05-bcdr/02_DPA.png[link=self, window=blank, width=100%]

. *oadp-dpa* 를 클릭하여 `DataProtectionApplication` 의 세부 정보를 확인한 다음 상단의 `YAML` 버튼을 클릭하여 구성 방법을 확인하세요.
+
image::2025_spring/module-05-bcdr/03_OADP_YAML.png[link=self, window=blank, width=100%]
+
*OADP* 가 *kubevirt* 플러그인을 추가하여 구성되었으며, 클러스터에서 실행 중인 OpenShift Data Foundations에서 제공하는 내부 객체 스토리지 버킷을 사용하도록 구성되었음을 확인하십시오.
+
IMPORTANT: 편의상 이 실습 환경에서는 백업을 로컬 오브젝트 버킷에 저장하도록 설정되어 있지만, 운영 환경에서는 로컬 재해로부터 워크로드를 보호하기 위해 백업을 외부 스토리지 시스템이나 클라우드 기반 오브젝트 스토리지 버킷으로 전송하는 것이 좋습니다.

[[create_backup]]
== 가상 머신 백업 생성

이제 이전 섹션에서 생성한 VM *fedora02* 의 백업을 수행합니다. 백업할 객체는 *app* 및 *vm.kubevirt.io/name* 레이블로 정의됩니다. 여기에는 VM 정의, 디스크, 그리고 구성 맵 및 시크릿과 같이 가상 머신에서 사용되는 추가 객체가 포함됩니다.

NOTE: 이전 섹션을 완료하지 않았거나 *fedora02* VM이 없는 경우, 위의 YAML에서 레이블 선택기를 다른 가상 머신에 맞게 변경하십시오.

. OADP Operator의 `세부 정보` 화면으로 돌아가서 가로 스크롤 막대를 사용하여 `Backup` 탭이 보일 때까지 아래로 스크롤합니다.

. `Backup` 탭을 클릭하고 `Backup 만들기` 버튼을 누르세요.
+
image::2025_summer/module-05-bcdr/04_Backup_Tab.png[link=self, window=blank, width=100%]

. `YAML보기` 로 전환하고 기본 내용을 다음 내용으로 바꾸세요.
+
[source,yaml,role=execute,subs="attributes"]
----
---
apiVersion: velero.io/v1
kind: Backup
metadata:
  name: backup-fedora02
  namespace: oadp-{user}
  labels:
    velero.io/storage-location: default
spec:
  defaultVolumesToFsBackup: false
  orLabelSelectors:
  - matchLabels:
      app: fedora02
  - matchLabels:
      vm.kubevirt.io/name: fedora02
  csiSnapshotTimeout: 10m0s
  ttl: 720h0m0s
  itemOperationTimeout: 4h0m0s
  storageLocation: oadp-dpa-1
  hooks: {}
  includedNamespaces:
  - vmexamples-{user}
  snapshotMoveData: false
----

. 하단의 `만들기` 버튼을 클릭하세요.
+
참고로, 이 YAML 파일의 내용은 네임스페이스 *vmexamples-{user}* 에서 *app: fedora02* 레이블이 있는 모든 객체가 *DataProtectionApplication* 구성에서 지정된 저장소로 백업됨을 나타냅니다.
+
image::2025_spring/module-05-bcdr/05_Create_Backup_YAML.png[link=self, window=blank, width=100%]

. `상태` 열이 *Completed* 로 바뀔 때까지 기다리세요. 이는 가상 머신 백업이 성공적으로 완료되었음을 나타냅니다.
+
image::2025_summer/module-05-bcdr/06_Backup_Completed.png[link=self, window=blank, width=100%]

[[restore_backup]]
== 백업에서 복원

. 왼쪽 메뉴에서 `가상화` 를 클릭한 다음 `VirtualMachines` 를 클릭합니다. 가운데 트리 열에서 *vmexamples-{user}* 프로젝트를 확장하고 *fedora02* VM을 클릭합니다.
+
image::2025_spring/module-05-bcdr/07_Fedora02_Overview.png[link=self, window=blank, width=100%]

. 가상 머신을 중지한 다음, 중지되면 `동작` 드롭다운 메뉴를 클릭하고 `삭제` 옵션을 선택합니다.
+
image::2025_spring/module-05-bcdr/08_Delete_VM.png[link=self, window=blank, width=100%]

. 메시지가 나타나면 빨간색 `삭제` 버튼을 클릭하여 가상 머신 삭제를 진행하십시오.
+
image::2025_spring/module-05-bcdr/09_Confirm_Delete.png[link=self, window=blank, width=100%]

. *fedora02* 가상 머신이 인벤토리에서 사라집니다.
+
image::2025_spring/module-05-bcdr/10_Deleted_VM.png[link=self, window=blank, width=100%]

. `에코시스템` 을 클릭한 다음 `설치된 Operator` 를 클릭하고 *OADP Operator* 를 다시 선택합니다. ( *oadp-{user}* 프로젝트로 다시 전환해야 할 수도 있습니다.)

. 가로 탐색 모음을 사용하여 `Restore` 탭을 찾고 클릭한 다음, `Restore 만들기` 를 누릅니다.
+
image::2025_summer/module-05-bcdr/11_Restore_Tab.png[link=self, window=blank, width=100%]

. YAML 보기로 전환하고 내용을 아래 내용으로 바꾸세요:
+
[source,yaml,role=execute,subs="attributes"]
----
---
apiVersion: velero.io/v1
kind: Restore
metadata:
  name: restore-fedora02
  namespace: oadp-{user}
spec:
  backupName: backup-fedora02
  includedResources: []
  excludedResources:
  - nodes
  - events
  - events.events.k8s.io
  - backups.velero.io
  - restores.velero.io
  restorePVs: true
----

. 하단의 `만들기` 버튼을 누르세요.
+
image::2025_spring/module-05-bcdr/12_Create_Restore_YAML.png[link=self, window=blank, width=100%]

. `상태` 열이 *Completed* 로 바뀔 때까지 기다리세요.
+
image::2025_summer/module-05-bcdr/13_Restore_Completed.png[link=self, window=blank, width=100%]

. `가상화` 메뉴로 돌아가서 아래 메뉴에서 `VirtualMachines` 을 클릭하고 *vmexamples-{user}* 프로젝트에 있는 *fedora02* 가상 머신이 복원되었는지 확인하세요. `작성` 항목에서 생성 시간이 얼마 전으로 표시되어 있을 것입니다.
+
image::2025_spring/module-05-bcdr/14_VM_Restored.png[link=self, window=blank, width=100%]

== 요약

가상 머신 보호는 가상화 플랫폼에서 매우 중요한 부분입니다. OpenShift Virtualization은 OADP를 사용하거나 스토리지 및 백업 파트너가 자사 제품을 통합할 수 있도록 지원하는 등 다양한 기본 보호 방법을 제공합니다. 가상 머신 보호 방법에 대한 질문이 있으시면 워크숍 담당자에게 문의하거나 공급업체에 연락하여 OpenShift Virtualization과의 호환성을 확인하십시오.
